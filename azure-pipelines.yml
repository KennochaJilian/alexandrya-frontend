trigger:
  - master
  - develop

variables:
  ${{ if eq( variables['Build.SourceBranchName'], 'master' ) }}:
    buildVersion: 'production'
    targetFolder: '/var/www/alexandrya.aquarius.irish'
  ${{ if eq( variables['Build.SourceBranchName'], 'develop' ) }}:
    buildVersion: 'test'
    targetFolder: '/var/www/alexandrya.test.aquarius.irish'

pool:
  vmImage: 'ubuntu-latest'

steps:
  - task: NodeTool@0
    inputs:
      versionSpec: '20.x'
    displayName: 'Install Node.js'

  - script: npm install
    displayName: 'npm install'
    workingDirectory: $(Build.SourcesDirectory)

  - script: npx ng lint
    displayName: 'execute lint'
    workingDirectory: $(Build.SourcesDirectory)

  - script: npx ng test  --browsers=ChromeHeadless --watch=false
    displayName: 'execute test'
    workingDirectory: $(Build.SourcesDirectory)

  - script: npm run build -c $(buildVersion)
    displayName: 'npm build'
    workingDirectory: $(Build.SourcesDirectory)

  - task: CopyFilesOverSSH@0
    inputs:
      sshEndpoint: 'SSH Aquarius VPS'
      sourceFolder: '$(Build.SourcesDirectory)/www/'
      contents: '**'
      targetFolder: '$(targetFolder)'
      readyTimeout: '20000'
